<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Sep 4, 2012
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Dmitry Grytsovets" />
    <meta name="Date-Creation-yyyymmdd" content="20120902" />
    <meta name="Date-Revision-yyyymmdd" content="20120904" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Tarantool Connector - Introduction</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Tarantool Connector for Java!</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="projectVersion">Version: 0.0.3-SNAPSHOT</li>
              
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2012-09-04</li> 
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                                
      <li class="active">
    
            <a href="#"><i class="none"></i>Introduction</a>
          </li>
                              <li class="nav-header">Project documentation</li>
                                                                                                                      
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                    
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>Tarantool Connector for Java!<a name="Tarantool_Connector_for_Java"></a></h2><p>The Tarantool Connector for Java provides ability to interact with <a class="externalLink" href="http://tarantool.org">Tarantool Box</a> on different levels of abstraction.</p><div class="section"><h3>Basic Usage<a name="Basic_Usage"></a></h3><p>You can find this classes in <b>org.tarantool.core</b> package.</p><div class="source"><pre class="prettyprint">
 int space = 0;

 TarantoolConnection connection = new SocketChannelTarantoolConnection(&quot;localhost&quot;, 33313);

 Tuple tuple = new Tuple(2).setInt(0, 1).setString(1, &quot;John Smith&quot;,&quot;UTF-8&quot;);

 int tuplesAffected = connection.insertOrReplace(space, tuple);

 connection.close();
</pre></div></div><div class="section"><h3>Standard Java Objects Conversion<a name="Standard_Java_Objects_Conversion"></a></h3><p>Look at the <b>TupleSupport</b> class in <b>org.tarantool.facade</b> package. It gives ability to convert Tuple to Object and Object to Tuple in very simple manner. </p><div class="source"><pre class="prettyprint"> TupleSupport tupleSupport = new TupleSupport();

 Tuple johnSmith = tupleSupport.create(1, &quot;John Smith&quot;, 188);

 Object[] array = tupleSupport.parse(johnSmith, Integer.class, String.class, Integer.class);</pre></div><p>You also can extend <b>TupleSupport</b> to convert any classes that you want. Example of custom type conversion below.</p><div class="source"><pre class="prettyprint"> TupleSupport customTupleSupport = new TupleSupport() {
    {
        supported.add(URL.class);
    }

    @Override
    protected void serUnknown(Tuple tuple, int i, Object object) {
        if (object instanceof URL) {
            tuple.setString(i, ((URL) object).toString(), DEFAULT_ENCODING);
        } else {
            super.serUnknown(tuple, i, object);
        }
    }

    @Override
    protected Object deserUnknown(Tuple tuple, Class&lt;?&gt; cls, int i) {
        if (URL.class.equals(cls)) {
            try {
                return new URL(tuple.getString(i, DEFAULT_ENCODING));
            } catch (MalformedURLException e) {
                throw new IllegalArgumentException(e);
            }
        } else {
            return super.deserUnknown(tuple, cls, i);
        }
    }
}
</pre></div></div><div class="section"><h3>POJO Mapping <a name="POJO_Mapping"></a></h3><p>Connector also gives ability to map Tuple to POJO. So you can work with POJOs not with Tuples. The simplest way to do this is annotations. Example below maps class User to space 0 and configures primary and secondary indexes. You should read about <b>Tarantool Box</b> configuration in <a class="externalLink" href="http://www.tarantool.org/tarantool_user_guide.html">user guide</a>. You can set custom <b>TupleSupport</b> if you need more data types.</p><div class="source"><pre class="prettyprint"> @Tuple(space = 0)
 public static class User {
     int id;
    String name;

    @Field(value = 0, index = { @Index(fieldNo = 0, indexNo = 0) })
    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    @Field(value = 1, index = { @Index(fieldNo = 0, indexNo = 1) })
    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
 }</pre></div><p>If you don't want to use annotations you can configure <b>Mapping</b> manually. </p><div class="source"><pre class="prettyprint"> Mapping&lt;User&gt; mapping = new Mapping&lt;User&gt;(User.class, 0,&quot;id&quot;, &quot;name&quot;);
 
 mapping.index(0, &quot;id&quot;);
 mapping.index(1, &quot;name&quot;);</pre></div><p>When you have configured POJO only few lines of code required to begin.</p><div class="source"><pre class="prettyprint"> SocketChannelPooledConnectionFactory connectionFactory = new SocketChannelPooledConnectionFactory();
 
 TarantoolTemplate template = new TarantoolTemplate(connectionFactory);
 
 User savedUser = template.save(user).insertOrReplaceAndGet();
 
 List&lt;User&gt; users = template.find(User.class,0, &quot;id&quot;).condition(user.getId()).list();
 </pre></div><p>You can set custom <b>TupleSupport</b> if you need more data types.</p><p>You can use <b>TarantoolTemplate7</b> and <b>Mapping7</b> when using java7. <b>Mapping7</b> uses <b>MethodHandle</b> to speed up get and set operations. </p></div><div class="section"><h3>Unit Testing<a name="Unit_Testing"></a></h3><p>Connector provides environment for unit testing.</p><div class="source"><pre class="prettyprint"> InMemoryTarantoolImpl test = new InMemoryTarantoolImpl();
 // init space num 0 where pk is element 0
 test.initSpace(0, 0); 
 /* init secondary key on space 0 
 * which is not unique and consists of fields 1 and 2 */
  test.initSecondaryKey(0, 1, false, 1, 2);  
 //now you can create connection 
 TarantoolConnection connection = new TarantoolConnectionImpl(test);
 // or connection factory
 SingleQueryConnectionFactory factory = new TestConnectionFactory(test);
 // and template
 TarantoolTemplate template = new TarantoolTemplate(factory);</pre></div></div><div class="section"><h3>Snapshot Support<a name="Snapshot_Support"></a></h3><p>Connector gives you capability to read/write tarantool snapshots. This feature gives many abilities. With <b>SnapshorReader</b> and <b>SnapshotWriter</b> you can easily create new snapshots, aggregate just created, change structure of each tuple and anything that you want. All this operations becomes fast and simple on snapshot level. You can create testing environment for you application using <b>SnapshotReader</b> and <b>InMemoryTarantoolImpl</b>.</p><div class="source"><pre class="prettyprint"> SnapshotReader reader = new SnapshotReader(new FileInputStream(&quot;test.snap&quot;).getChannel());
 try {
   Row row = null;
     while ((row = reader.readNext()) != null) {
       Tuple tuple=row.data;
       ...
      }
 } finally {
   reader.close();
 }</pre></div><div class="source"><pre class="prettyprint"> SnapshotWriter writer = new SnapshotWriter(new FileOutputStream(&quot;test.snap&quot;).getChannel());
 try {
    int space = 0;
    Tuple tuple = new Tuple(3).setInt(0, 1).setString(1, &quot;John Smith&quot;, &quot;UTF-8&quot;).setInt(2, 1983);
    writer.write(space, Const.SNAP_TAG, tuple);
  } finally {
    writer.close();
 }
 +-----+</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2012.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
